<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parque de las Heliconias - Panel de Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Incluir Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- CSS personalizado -->
    <link rel="stylesheet" href="css/reporte.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="top-section">
            <div class="logo">
                <div class="logo-img">
                    <i class="fas fa-leaf"></i>
                </div>
                <h1>Heliconias Reports</h1>
            </div>
            <!-- Navegaci칩n horizontal -->
            <nav class="main-nav">
                <a href="principal.html" class="nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a href="eventos.html" class="nav-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Eventos</span>
                </a>
                <a href="actividad.html" class="nav-item">
                    <i class="fas fa-hiking"></i>
                    <span>Actividades</span>
                </a>
                <a href="reportes.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Reportes</span>
                </a>
                <a href="configuracion.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Configuraci칩n</span>
                </a>
            </nav>
        </div>
    </header>

    <div class="top-bar">
        <div class="system-date">
            <i class="fas fa-clock"></i>
            <span id="current-date-time">Cargando fecha y hora...</span>
        </div>

        <div class="user-actions">
            <a href="soporte.html" class="btn btn-primary">
                <i class="fas fa-headset"></i> Soporte
            </a>
            <button class="btn btn-primary" id="help-main-btn">
                <i class="fas fa-question-circle"></i> Ayuda
            </button>
            <button class="btn btn-accent" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Salir
            </button>
        </div>
    </div>

    <!-- Contenido principal -->
    <main>
        <!-- Panel Principal -->
        <div class="main-container" id="main-panel">
            <div class="buttons-container">
                <h2>Panel de Informes</h2>
                <p>Selecciona una opci칩n para comenzar a trabajar con los informes del parque</p>
                <div class="primary-buttons">
                    <button class="btn-primary-large" id="write-report-btn">
                        <i class="fas fa-file-signature"></i>
                        Escribir Informe
                    </button>
                    <button class="btn-primary-large" id="consult-report-btn">
                        <i class="fas fa-search-plus"></i>
                        Consultar Informe
                    </button>
                </div>
            </div>
        </div>

        <!-- Editor de Informes -->
        <div class="editor-container" id="editor-panel">
            <!-- El contenido se carga din치micamente -->
        </div>
    </main>

    <!-- Sidebar de historial - MEJORADO -->
    <div class="history-sidebar" id="history-sidebar">
        <div class="history-header">
            <h3><i class="fas fa-history"></i> Historial de Informes</h3>
            <button class="history-toggle" id="history-toggle" title="Ocultar historial">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="history-content">
            <!-- Filtros y b칰squeda -->
            <div class="history-filters">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-reports" placeholder="Buscar reportes...">
                </div>
            </div>
            
            <!-- Tabs de estado -->
            <div class="history-tabs">
                <button class="history-tab active" data-tab="all">
                    <i class="fas fa-list"></i> Todos
                    <span class="tab-count" id="count-all">0</span>
                </button>
                <button class="history-tab" data-tab="borrador">
                    <i class="fas fa-edit"></i> Borradores
                    <span class="tab-count" id="count-borrador">0</span>
                </button>
                <button class="history-tab" data-tab="finalizado">
                    <i class="fas fa-check-circle"></i> Finalizados
                    <span class="tab-count" id="count-finalizado">0</span>
                </button>
            </div>
            
            <!-- Informaci칩n de resumen -->
            <div class="history-stats">
                <div class="stat-item">
                    <i class="fas fa-file-alt"></i>
                    <div>
                        <span class="stat-number" id="total-reports">0</span>
                        <span class="stat-label">Total</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <div>
                        <span class="stat-number" id="recent-reports">0</span>
                        <span class="stat-label">칔ltimos 7 d칤as</span>
                    </div>
                </div>
            </div>
            
            <!-- Lista de reportes -->
            <div class="reports-list-container">
                <div class="reports-list-header">
                    <h4><i class="fas fa-file"></i> Reportes</h4>
                    <button class="btn-refresh" id="refresh-reports" title="Actualizar lista">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="reports-list" id="reports-list">
                    <!-- Los reportes se cargan din치micamente aqu칤 -->
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Cargando reportes...</p>
                    </div>
                </div>
            </div>
            
            <!-- Acciones r치pidas -->
            <div class="history-actions">
                <button class="btn-action-new" id="new-report-from-history">
                    <i class="fas fa-plus-circle"></i> Nuevo Reporte
                </button>
                <button class="btn-action-help" id="help-history">
                    <i class="fas fa-question-circle"></i> Ayuda
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Configuraci칩n de Supabase - CORREGIDO -->
    <script>
        // Configuraci칩n de Supabase
        const supabaseUrl = 'https://umncnddwzmjxgmvisvqz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtbmNuZGR3em1qeGdtdmlzdnF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NDIyNzksImV4cCI6MjA3ODExODI3OX0.ODvus28cTCTD8gGewQ2sAZ8PcXbEe4CIy_zv6bip8J0';
        
        // IMPORTANTE: Asignar a window.supabase
        window.supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // Verificar en consola
        console.log('游댋 Supabase inicializado:', window.supabase ? 'S칈' : 'NO');
    </script>
    
    <script src="js/reporte.js"></script>
    <script src="js/editor-functions.js"></script>
    <script src="js/table-functions.js"></script>
    <script src="js/image-functions.js"></script>
    <script src="js/graficas-functions.js"></script>
    <script src="js/shared-functions.js"></script>
    <script src="js/db-functions.js"></script>
    
    <!-- Script para inicializar funcionalidades del historial -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para el historial
            const refreshBtn = document.getElementById('refresh-reports');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    if (typeof loadReports === 'function') {
                        loadReports();
                    }
                });
            }
            
            const newReportBtn = document.getElementById('new-report-from-history');
            if (newReportBtn) {
                newReportBtn.addEventListener('click', function() {
                    const writeReportBtn = document.getElementById('write-report-btn');
                    if (writeReportBtn) {
                        writeReportBtn.click();
                    }
                });
            }
            
            const helpHistoryBtn = document.getElementById('help-history');
            if (helpHistoryBtn) {
                helpHistoryBtn.addEventListener('click', function() {
                    Swal.fire({
                        title: 'Ayuda - Historial de Reportes',
                        html: `
                            <div style="text-align: left;">
                                <h4>쮺칩mo usar el historial?</h4>
                                <ul style="padding-left: 20px;">
                                    <li><strong>Ver todos los reportes:</strong> Usa la pesta침a "Todos"</li>
                                    <li><strong>Filtrar por estado:</strong> Usa "Borradores" o "Finalizados"</li>
                                    <li><strong>Buscar reportes:</strong> Escribe en el campo de b칰squeda</li>
                                    <li><strong>Acciones r치pidas:</strong> Haz clic en los botones de cada reporte</li>
                                </ul>
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <small><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Puedes arrastrar elementos dentro de los reportes en modo edici칩n.</small>
                                </div>
                            </div>
                        `,
                        icon: 'info',
                        confirmButtonColor: '#27ae60'
                    });
                });
            }
            
            // B칰squeda de reportes
            const searchInput = document.getElementById('search-reports');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const reportItems = document.querySelectorAll('.report-item');
                    
                    reportItems.forEach(item => {
                        const title = item.querySelector('.report-title h4')?.textContent.toLowerCase() || '';
                        const content = item.querySelector('.report-preview')?.textContent.toLowerCase() || '';
                        
                        if (title.includes(searchTerm) || content.includes(searchTerm)) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>