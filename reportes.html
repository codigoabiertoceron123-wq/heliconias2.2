<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parque de las Heliconias - Panel de Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
      <!-- Incluir Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Inicializar Supabase
    const supabaseUrl = 'https://umncnddwzmjxgmvisvqz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtbmNuZGR3em1qeGdtdmlzdnF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NDIyNzksImV4cCI6MjA3ODExODI3OX0.ODvus28cTCTD8gGewQ2sAZ8PcXbEe4CIy_zv6bip8J0';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white; /* Fondo blanco */
            z-index: -1;
        }
        /* Header Styles */
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #ffffff, #ffffff);
            color: #2e7d32;
            padding: 15px 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo {
            display: flex;           /* Activar flexbox */
            align-items: center;     /* Centrar verticalmente el contenido */
            gap: 15px;               /* Espacio entre logo y t√≠tulo */
        }

        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-img i {
            display: block;
            width: 100%;
            height: 100%;
            background-image: url("img/logo.png"); /* Tu logo real */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0; /* Oculta el √≠cono de fontawesome */
            color: transparent;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between; /* izquierda - derecha */
            align-items: center;            /* misma l√≠nea */
            width: 100%;
            margin-bottom: 10px;
            margin-top: 15px; 
        }

        .system-date {
            display: flex;
            margin-left: 20px;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: #000000;
            background: rgba(255, 255, 255, 0.15); /* efecto cristal */
            padding: 10px 18px;
            border-radius: 25px;
            backdrop-filter: blur(6px);  /* efecto vidrio borroso */
            -webkit-backdrop-filter: blur(6px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            font-size: 15px;
            letter-spacing: 0.5px;        /* m√°s elegante */
        }

        /* Navigation Styles */
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .main-nav {
            display: flex;
            gap: 5px;
            left: 50px;/* ajusta el valor para mover m√°s a la izquierda o derecha */
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            color: #2e7d32;
            text-decoration: none;
            border-radius: 6px;
            position: relative;
            background: transparent; /* quitar fondo */
            transition: all 0.3s ease;
        }

        /* L√≠nea inferior al pasar el mouse */
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10%;           /* margen izquierdo de la l√≠nea */
            width: 80%;          /* ancho de la l√≠nea */
            height: 2px;         /* grosor de la l√≠nea */
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            transform: scaleX(0); /* inicialmente invisible */
            transition: transform 0.3s ease;
            transform-origin: center;
        }

        .nav-item:hover::after {
            transform: scaleX(1); /* l√≠nea aparece */
        }

        .user-actions {
            display: flex;        /* ya estaba flex */
            justify-content: flex-end;  /* esto los lleva a la derecha */
            gap: 10px; 
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            position: relative;
            left: -20px; /* mueve cada bot√≥n 20px hacia la izquierda */
        }

        .btn-primary {
            background: linear-gradient(135deg, #2e7d32, #4caf50); /* verde degradado */
            color: white;
        }


        .btn-accent {
            background: linear-gradient(135deg, #e74c3c, #fe5926); 
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }


        /* Main Content Styles */
        main {
            padding: 20px;
            min-height: calc(100vh - 140px);
        }

        /* Botones principales */
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh;
            gap: 30px;
        }

        .buttons-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 2px solid #e8f5e8;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            min-width: 500px;
        }

        .buttons-container h2 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .buttons-container p {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 20px;
        }

        .primary-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            align-items: center;
        }

        .help-container {
            margin-top: 20px;
        }

        .btn-primary-large {
            background: #2e7d32;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
            position: relative;
        }

        .btn-primary-large:hover {
            background: #219653;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
        }

        .btn-primary-large:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(39, 174, 96, 0.4);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.6);
        }

        /* Editor de Informes */
        .editor-container {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 15px;
            margin-top: 15px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8f5e8;
        }

        .editor-tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .tool-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .tool-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .tool-btn:hover {
            background: #e8f5e8;
            border-color: #27ae60;
        }

        select.tool-btn {
            min-width: 100px;
        }

        .zoom-controls {
            display: flex;
            gap: 5px;
            align-items: center;
            margin-left: auto;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: #e8f5e8;
        }

        .orientation-controls {
            display: flex;
            gap: 5px;
            margin-left: 15px;
        }

        .orientation-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .orientation-btn.active {
            background: #2e7d32;
            color: white;
            border-color: #2e7d32;
        }

        .pages-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 65vh;
            overflow-y: auto;
            padding: 8px;
            transform-origin: top center;
            transition: transform 0.3s ease;
        }

        .page {
            background: white;
            border: 2px solid #e8f5e8;
            border-radius: 8px;
            padding: 20px;
            min-height: 320px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            transition: min-height 0.3s ease;
        }

        .page.vertical {
            min-height: 320px;
        }

        .page.horizontal {
            min-height: 220px;
            max-width: 1000px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e8f5e8;
        }

        .page-content {
            min-height: 220px;
            outline: none;
            padding: 8px;
            line-height: 1.5;
            position: relative;
        }

        .page-number {
            position: absolute;
            bottom: 8px;
            right: 12px;
            color: #7f8c8d;
            font-size: 0.8rem;
        }

        .page.portada {
            background: linear-gradient(135deg, #f8fff8, #e8f5e8);
        }

        .page.contraportada {
            background: linear-gradient(135deg, #f0fff0, #e0f5e0);
        }

        /* Elementos arrastrables y redimensionables */
        .draggable-element {
            position: absolute;
            cursor: move;
            border: 1px dashed transparent;
            transition: border-color 0.2s ease;
            min-width: 50px;
            min-height: 50px;
        }

        .draggable-element:hover {
            border-color: #2e7d32;
        }

        .draggable-element.selected {
            border-color: #2e7d32;
            background: rgba(39, 174, 96, 0.05);
        }

        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 100;
        }

        .draggable-element:hover .delete-btn {
            display: flex;
        }

        .resize-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            border-radius: 50%;
            z-index: 10;
        }

        .resize-handle.nw { top: -4px; left: -4px; cursor: nw-resize; }
        .resize-handle.ne { top: -4px; right: -4px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -4px; left: -4px; cursor: sw-resize; }
        .resize-handle.se { bottom: -4px; right: -4px; cursor: se-resize; }

        /* Estilos para tablas */
        .table-container {
            margin: 10px 0;
            overflow-x: auto;
            position: relative;
        }

        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin: 5px 0;
        }

        .custom-table th,
        .custom-table td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            text-align: left;
            min-width: 80px;
        }

        .custom-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .table-controls {
            display: flex;
            gap: 5px;
            margin: 5px 0;
        }

        .table-control-btn {
            padding: 3px 8px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .create-chart-btn {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Estilos para gr√°ficos */
        .chart-container {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
            position: relative;
        }

        .chart-placeholder {
            width: 100%;
            height: 150px;
            background: white;
            border: 1px dashed #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            justify-content: center;
        }

        .chart-type-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .chart-type-btn.active {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            border-color: #27ae60;
        }

        /* Estilos para im√°genes */
        .image-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        /* Estilos para SweetAlert personalizado */
        .swal2-popup.event-modal {
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
            width: 500px;
            border: 2px solid #e8f5e8;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .swal2-header.event-modal-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 25px 30px 20px;
            margin: 0;
            border-radius: 13px 13px 0 0;
        }

        .swal2-title.event-modal-title {
            color: white;
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .swal2-html-container.event-modal-content {
            padding: 25px 30px;
            margin: 0;
            text-align: left;
        }

        .btn-primary2 {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .main-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px;
            }
            
            .top-section {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-item {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            main {
                padding: 15px;
            }

            .buttons-container {
                min-width: auto;
                width: 100%;
                padding: 30px 20px;
            }

            .primary-buttons {
                flex-direction: column;
                gap: 20px;
            }

            .editor-tools {
                flex-direction: column;
            }

            .tool-group {
                justify-content: center;
            }

            .page {
                padding: 15px;
                min-height: 280px;
            }
        }

        @media (max-width: 480px) {
            .nav-item {
                padding: 6px 10px;
                font-size: 0.8rem;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .logo h1 {
                font-size: 1.1rem;
            }

            .logo-img {
                width: 40px;
                height: 40px;
            }

            .system-date {
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            .btn-primary-large {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .btn-info {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }

        /* Bot√≥n cerrar editor */
.btn-close-editor {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-close-editor:hover {
    background: #c0392b;
    transform: translateY(-2px);
}

/* Sidebar de historial */
.history-sidebar {
    position: fixed;
    left:  50px;
    top: 190px;
    width: 350px;
    height: calc(100vh - 140px);
    background: white;
    border-right: 1px solid #e0e0e0;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    z-index: 1000;
}

.history-sidebar.collapsed {
    transform: translateX(-100%);
}

.history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: #f8f9fa;
    border-bottom: 1px solid #e0e0e0;
}

.history-header h3 {
    margin: 0;
    color: #2c3e50;
    font-size: 1.2rem;
}

.history-toggle {
    background: linear-gradient(135deg, #2e7d32, #4caf50);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.history-toggle:hover {
    background: linear-gradient(135deg, #2e7d32, #4caf50);
}

.history-content {
    height: calc(100% - 80px);
    display: flex;
    flex-direction: column;
}

.history-tabs {
    display: flex;
    background: white;
    border-bottom: 1px solid #e0e0e0;
    padding: 15px 20px 0;
    gap: 5px;
}

.history-tab {
    flex: 1;
    padding: 10px 5px;
    border: none;
    background: #f8f9fa;
    color: #7f8c8d;
    cursor: pointer;
    border-radius: 8px 8px 0 0;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.history-tab.active {
    background: linear-gradient(135deg, #2e7d32, #4caf50);
    color: white;
}

.history-tab:hover:not(.active) {
    background: #e9ecef;
    color: #2c3e50;
}

.reports-list {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: white;
}

.report-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 4px solid #2e7d32;
}

.report-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-left-color: #2e7d32;
}

.report-card.borrador {
    border-left-color: #f39c12;
}

.report-card.finalizado {
    border-left-color: #2e7d32;
}

.report-title {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    font-size: 1rem;
}

.report-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #7f8c8d;
    margin-bottom: 8px;
}

.report-status {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-borrador {
    background: #fff3cd;
    color: #856404;
}

.status-finalizado {
    background: #d1ecf1;
    color: #0c5460;
}

.report-preview {
    font-size: 0.85rem;
    color: #7f8c8d;
    line-height: 1.4;
    max-height: 60px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.no-reports {
    text-align: center;
    padding: 40px 20px;
    color: #7f8c8d;
}

.no-reports i {
    font-size: 3rem;
    margin-bottom: 15px;
    color: #bdc3c7;
}

/* Ajustar el main content cuando el sidebar est√° visible */
main {
    padding: 20px;
    min-height: calc(100vh - 140px);
    margin-left: 350px; /* Espacio para el sidebar */
    transition: margin-left 0.3s ease;
}

.history-sidebar.collapsed + main {
    margin-left: 0;
}

/* Responsive */
@media (max-width: 1024px) {
    .history-sidebar {
        width: 300px;
    }
    
    main {
        margin-left: 300px;
    }
}

@media (max-width: 768px) {
    .history-sidebar {
        width: 100%;
        transform: translateX(-100%);
    }
    
    .history-sidebar:not(.collapsed) {
        transform: translateX(0);
    }
    
    main {
        margin-left: 0;
    }
}

/* Estilos adicionales para el modal de reportes */
.report-modal .swal2-popup {
    max-width: 900px;
    padding: 0;
}

.report-modal .swal2-html-container {
    padding: 0;
    margin: 0;
}

/* Estilos para las tablas en el modal */
.report-modal table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
}

.report-modal th,
.report-modal td {
    border: 1px solid #ddd;
    padding: 8px 12px;
    text-align: left;
}

.report-modal th {
    background: #f8f9fa;
    font-weight: 600;
}

.report-modal tr:nth-child(even) {
    background: #f8f9fa;
}

/* Estilos para las im√°genes en el modal */
.report-modal img {
    max-width: 100%;
    height: auto;
    border-radius: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Mejorar la visualizaci√≥n de elementos */
.report-modal .element-container {
    margin: 10px 0;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border-left: 4px solid #2e7d32;
}
    </style>
</head>
<body>
      <!-- Header -->
        <header class="header">
            <div class="top-section">
                <div class="logo">
                    <div class="logo-img">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h1>Heliconias Reports</h1>
                </div>
                    <!-- Navegaci√≥n horizontal -->
                <nav class="main-nav">
                    <a href="principal.html" class="nav-item active tooltip">
                        <i class="fas fa-home"></i>
                        <span>Inicio</span>
                    </a>
                    <a href="eventos.html" class="nav-item tooltip">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Eventos</span>
                    </a>
                    <a href="actividad.html" class="nav-item tooltip">
                        <i class="fas fa-hiking"></i>
                        <span>Actividades</span>
                    </a>
                    <a href="reportes.html" class="nav-item tooltip">
                        <i class="fas fa-chart-line"></i>
                        <span>Reportes</span>
                    </a>
                    <a href="configuracion.html" class="nav-item tooltip">
                        <i class="fas fa-cog"></i>
                        <span>Configuraci√≥n</span>
                    </a>
                </nav>
            </div>
        </header>

        <div class="top-bar">
            <div class="system-date">
                <i class="fas fa-clock"></i>
                <span id="current-date-time">Cargando fecha y hora...</span>
            </div>

            <div class="user-actions">
                <a href="soporte.html" class="btn btn-primary tooltip">
                    <i class="fas fa-headset"></i> Soporte
                </a>

                <button class="btn btn-primary tooltip" id="help-main-btn">
                    <i class="fas fa-question-circle"></i> Ayuda
                </button>

                <button class="btn btn-accent tooltip" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
    <!-- Contenido principal -->
    <main>
        <!-- Panel Principal -->
        <div class="main-container" id="main-panel">
            <div class="buttons-container">
                <h2>Panel de Informes</h2>
                <p>Selecciona una opci√≥n para comenzar a trabajar con los informes del parque</p>
                <div class="primary-buttons">
                    <button class="btn-primary-large" id="write-report-btn">
                        <i class="fas fa-file-signature"></i>
                        Escribir Informe
                    </button>

                    <button class="btn-primary-large">
                        <i class="fas fa-search-plus"></i>
                        Consultar Informe
                    </button>
                </div>
                
            </div>
        </div>

        <!-- Editor de Informes -->
        <div class="editor-container" id="editor-panel">
            <div class="editor-header">
                <h2>Editor de Informes</h2>
                
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-close-editor" id="close-editor-btn" title="Cerrar editor">
            <i class="fas fa-times"></i> Cerrar
        </button>
                    
                    <div class="orientation-controls">
                        <button class="orientation-btn active" onclick="changeOrientation('vertical')" title="Vertical">
                            <i class="fas fa-portrait"></i>
                        </button>
                        <button class="orientation-btn" onclick="changeOrientation('horizontal')" title="Horizontal">
                            <i class="fas fa-landscape"></i>
                        </button>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="changeZoom(-0.1)" title="Alejar">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <span id="zoom-level" style="font-size: 0.9rem;">100%</span>
                        <button class="zoom-btn" onclick="changeZoom(0.1)" title="Acercar">
                            <i class="fas fa-search-plus"></i>
                        </button>
                    </div>
                    <button class="btn-primary-large" id="save-report-btn">
                        <i class="fas fa-save"></i>
                        Guardar
                    </button>
                </div>
            </div>

            <div class="editor-tools">
                <div class="tool-group">
                    <button class="tool-btn" onclick="addPage()" title="Nueva Hoja">
                        <i class="fas fa-plus"></i> Hoja
                    </button>
                    <button class="tool-btn" onclick="showTableModal()" title="Insertar Tabla">
                        <i class="fas fa-table"></i> Tabla
                    </button>
                    <button class="tool-btn" onclick="showImageModal()" title="Insertar Imagen">
                        <i class="fas fa-image"></i> Imagen
                    </button>
                    <button class="tool-btn" onclick="showChartModal()" title="Insertar Gr√°fico">
                        <i class="fas fa-chart-bar"></i> Gr√°fico
                    </button>
                </div>
                <div class="tool-group">
                    <select class="tool-btn" onchange="changeFontFamily(this.value)" title="Fuente">
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Courier New">Courier New</option>
                    </select>
                    <select class="tool-btn" onchange="changeFontSize(this.value)" title="Tama√±o">
                        <option value="1">Peque√±o</option>
                        <option value="3" selected>Normal</option>
                        <option value="5">Grande</option>
                        <option value="7">Muy Grande</option>
                    </select>
                    <button class="tool-btn" onclick="formatText('bold')" title="Negrita">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="tool-btn" onclick="formatText('italic')" title="Cursiva">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="tool-btn" onclick="formatText('underline')" title="Subrayado">
                        <i class="fas fa-underline"></i>
                    </button>
                </div>
            </div>

            <div class="pages-container" id="pages-container">
                <!-- Las p√°ginas se generan din√°micamente -->
            </div>
        </div>
    </main>

    <!-- Agrega este contenedor de historial despu√©s del main-container -->
<div class="history-sidebar" id="history-sidebar">
    <div class="history-header">
        <h3>Historial de Informes</h3>
        <button class="history-toggle" id="history-toggle">
            <i class="fas fa-chevron-left"></i>
        </button>
    </div>
    <div class="history-content">
        <div class="history-tabs">
            <button class="history-tab active" data-tab="all">Todos</button>
            <button class="history-tab" data-tab="borrador">Borradores</button>
            <button class="history-tab" data-tab="finalizado">Finalizados</button>
        </div>
        <div class="reports-list" id="reports-list">
            <!-- Los reportes se cargan din√°micamente -->
        </div>
    </div>
</div>
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

         // Variable global para el usuario
    let currentUser = null;
    // Variables globales
    // Funci√≥n para actualizar fecha y hora
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString("es-ES", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                hour12: true,
            });

            const dateTimeElement = document.getElementById("current-date-time");
            if (dateTimeElement) {
                dateTimeElement.textContent = dateTimeString;
            }
        }

        // Inicializar fecha y hora
        updateDateTime();
        setInterval(updateDateTime, 1000);

        let currentPage = 0;
        const pages = [];
        let currentZoom = 1;
        let currentOrientation = 'vertical';
        let selectedElement = null;
        let isDragging = false;
        let isResizing = false;
        let dragOffset = { x: 0, y: 0 };
        let currentResizeHandle = null;
        // Variables globales para el historial
let currentReportTab = 'all';
let reports = [];
// Bot√≥n cerrar editor - VERSI√ìN ACTUALIZADA
document.getElementById('close-editor-btn').addEventListener('click', closeEditor);
// Bot√≥n de ayuda del header
document.getElementById('help-main-btn').addEventListener('click', function() {
    Swal.fire({
        title: '<div style="display: flex; align-items: center; gap: 10px; color: #2c3e50;"><i class="fas fa-file-alt" style="color: #27ae60; font-size: 1.5rem;"></i><span>Sistema de Reportes - Heliconias</span></div>',
        html: `
            <div style="text-align: left;">
                <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin: 0; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-lightbulb"></i>
                        ¬øQu√© puedes hacer aqu√≠?
                    </h4>
                </div>
                
                <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #27ae60;">
                        <i class="fas fa-file-signature" style="color: #27ae60; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Editor de Informes Avanzado</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Crea reportes profesionales con p√°ginas predefinidas: portada, √≠ndice, resumen y desarrollo</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                        <i class="fas fa-table" style="color: #3498db; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Insertar Elementos Din√°micos</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Agrega tablas editables, im√°genes y gr√°ficos interactivos a tus reportes</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e74c3c;">
                        <i class="fas fa-arrows-alt" style="color: #e74c3c; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Elementos Arrastrables</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Mueve y redimensiona tablas, im√°genes y gr√°ficos libremente en la p√°gina</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #9b59b6;">
                        <i class="fas fa-history" style="color: #9b59b6; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Historial de Reportes</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Consulta todos tus reportes guardados en el panel lateral izquierdo</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #f39c12;">
                        <i class="fas fa-cloud-upload-alt" style="color: #f39c12; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Almacenamiento en la Nube</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Tus im√°genes se guardan autom√°ticamente en el servidor para acceso permanente</p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #1abc9c;">
                        <i class="fas fa-search" style="color: #1abc9c; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #2c3e50;">Visualizaci√≥n Completa</strong>
                            <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Revisa reportes completos con todos los elementos organizados en modales interactivos</p>
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #ffeaa7, #fab1a0); padding: 15px; border-radius: 10px; border-left: 4px solid #e17055; margin-bottom: 20px;">
                    <h5 style="margin: 0 0 8px 0; color: #2d3436; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-graduation-cap"></i>
                        Flujo de Trabajo Recomendado
                    </h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-play" style="color: #27ae60;"></i>
                            1. Crear informe
                        </span>
                        <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-edit" style="color: #3498db;"></i>
                            2. Agregar contenido
                        </span>
                        <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-shapes" style="color: #e74c3c;"></i>
                            3. Insertar elementos
                        </span>
                        <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-save" style="color: #f39c12;"></i>
                            4. Guardar en BD
                        </span>
                        <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-eye" style="color: #9b59b6;"></i>
                            5. Consultar historial
                        </span>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                    <p style="margin: 0; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-database"></i>
                        Todos los reportes se guardan autom√°ticamente en la base de datos de Supabase
                    </p>
                </div>
            </div>
        `,
        icon: 'info',
        showCloseButton: true,
        confirmButtonColor: '#27ae60',
        confirmButtonText: '<i class="fas fa-check-circle"></i> ¬°Empezar a crear reportes!',
        width: 700,
        background: '#ffffff',
        customClass: {
            popup: 'animated-popup',
            title: 'custom-title',
            htmlContainer: 'custom-html',
            confirmButton: 'custom-confirm-btn'
        },
        showClass: {
            popup: 'animate__animated animate__fadeInDown'
        },
        hideClass: {
            popup: 'animate__animated animate__fadeOutUp'
        }
    });
});
// Funci√≥n para cargar reportes desde Supabase
async function loadReports() {
    try {
        const { data, error } = await supabase
            .from('reportes')
            .select('*')
            .order('fecha_creacion', { ascending: false });

        if (error) throw error;

        reports = data;
        renderReports();
    } catch (error) {
        console.error('Error cargando reportes:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'No se pudieron cargar los reportes',
            confirmButtonColor: '#e74c3c'
        });
    }
}

// Funci√≥n para renderizar reportes en el historial
function renderReports() {
    const reportsList = document.getElementById('reports-list');
    if (!reportsList) return;

    // Filtrar reportes seg√∫n la pesta√±a activa
    const filteredReports = reports.filter(report => {
        if (currentReportTab === 'all') return true;
        return report.estado === currentReportTab;
    });

    if (filteredReports.length === 0) {
        reportsList.innerHTML = `
            <div class="no-reports">
                <i class="fas fa-file-alt"></i>
                <h4>No hay reportes</h4>
                <p>${currentReportTab === 'all' ? 'No hay reportes registrados' : 
                   currentReportTab === 'borrador' ? 'No hay borradores' : 
                   'No hay reportes finalizados'}</p>
            </div>
        `;
        return;
    }

    reportsList.innerHTML = filteredReports.map(report => `
        <div class="report-card ${report.estado}" onclick="viewReport(${report.id_reporte})">
            <div class="report-title">${report.titulo}</div>
            <div class="report-meta">
                <span><i class="fas fa-calendar"></i> ${new Date(report.fecha_creacion).toLocaleDateString()}</span>
                <span class="report-status status-${report.estado}">${report.estado}</span>
            </div>
            <div class="report-preview">
                ${report.contenido ? 
                    JSON.parse(report.contenido)[0]?.content?.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : 
                    'Sin contenido'}
            </div>
        </div>
    `).join('');
}

// Funci√≥n para ver un reporte completo
async function viewReport(reportId) {
    try {
        const { data, error } = await supabase
            .from('reportes')
            .select('*')
            .eq('id_reporte', reportId)
            .single();

        if (error) throw error;

        showReportModal(data);
    } catch (error) {
        console.error('Error cargando reporte:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'No se pudo cargar el reporte',
            confirmButtonColor: '#e74c3c'
        });
    }
}
// Funci√≥n para mostrar el reporte en un modal de SweetAlert
function showReportModal(report) {
    const pages = JSON.parse(report.contenido || '[]');
    const elementos = report.elementos || [];
    
    let modalContent = `
        <div style="text-align: left; max-height: 70vh; overflow-y: auto;">
            <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h2 style="margin: 0 0 10px 0;">${report.titulo}</h2>
                <div style="display: flex; gap: 15px; font-size: 0.9rem;">
                    <span><i class="fas fa-calendar"></i> ${new Date(report.fecha_creacion).toLocaleDateString()}</span>
                    <span><i class="fas fa-user"></i> Usuario ${report.id_usuario}</span>
                    <span class="report-status status-${report.estado}">${report.estado}</span>
                </div>
            </div>
    `;

    // Mostrar p√°ginas (LIMPIANDO las im√°genes del contenido)
    pages.forEach((page, index) => {
        // Limpiar el contenido de la p√°gina - remover elementos arrastrables
        let cleanContent = page.content || '';
        
        // Remover todos los elementos draggable (im√°genes, tablas, gr√°ficos) del contenido
        cleanContent = cleanContent.replace(/<div[^>]*class="[^"]*draggable-element[^"]*"[^>]*>[\s\S]*?<\/div>/g, '');
        
        // Tambi√©n remover cualquier imagen suelta que no est√© en un contenedor draggable
        cleanContent = cleanContent.replace(/<img[^>]*>/g, 'üñºÔ∏è [Imagen movida a la secci√≥n de elementos]');
        
        modalContent += `
            <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                <div style="border-bottom: 2px solid #27ae60; padding-bottom: 10px; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #27ae60;">${page.title}</h3>
                </div>
                <div style="min-height: 100px; line-height: 1.6;">
                    ${cleanContent || '<p style="color: #7f8c8d; font-style: italic;">Sin contenido</p>'}
                </div>
                <div style="text-align: right; margin-top: 15px; color: #7f8c8d; font-size: 0.8rem;">
                    P√°gina ${page.pageNumber}
                </div>
            </div>
        `;
    });

    // Mostrar elementos (tablas, im√°genes, gr√°ficos) si existen
    if (elementos.length > 0) {
        modalContent += `
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px;">
                <h4 style="margin: 0 0 20px 0; color: #2c3e50; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-shapes"></i> Elementos del Reporte (${elementos.length})
                </h4>
                <div style="display: grid; gap: 20px;">
        `;

        elementos.forEach((elemento, index) => {
            if (elemento.type === 'image') {
                // Mostrar imagen directamente
                modalContent += `
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #e74c3c;">
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-image" style="color: #e74c3c;"></i>
                            Imagen ${index + 1}
                            <span style="font-size: 0.8rem; color: #7f8c8d; margin-left: auto;">
                                P√°gina ${elemento.page || 1}
                            </span>
                        </div>
                        <div style="margin: 15px 0; text-align: center;">
                            <img src="${elemento.content}" 
                                 style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 1px solid #e0e0e0;"
                                 alt="Imagen del reporte"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                            <div style="display: none; background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> No se pudo cargar la imagen
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><strong>Posici√≥n:</strong> X:${elemento.position.x}px, Y:${elemento.position.y}px</div>
                            <div><strong>Tama√±o:</strong> ${elemento.size.width}√ó${elemento.size.height}px</div>
                        </div>
                    </div>
                `;
            } else if (elemento.type === 'table') {
                // Mostrar tabla
                modalContent += `
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #3498db;">
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-table" style="color: #3498db;"></i>
                            Tabla ${index + 1}
                            <span style="font-size: 0.8rem; color: #7f8c8d; margin-left: auto;">
                                P√°gina ${elemento.page || 1}
                            </span>
                        </div>
                        <div style="overflow-x: auto; margin: 10px 0;">
                            ${elemento.content}
                        </div>
                        <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><strong>Posici√≥n:</strong> X:${elemento.position.x}px, Y:${elemento.position.y}px</div>
                            <div><strong>Tama√±o:</strong> ${elemento.size.width}√ó${elemento.size.height}px</div>
                        </div>
                    </div>
                `;
            } else if (elemento.type === 'chart') {
                // Mostrar gr√°fico
                modalContent += `
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-chart-bar" style="color: #9b59b6;"></i>
                            Gr√°fico ${index + 1}
                            <span style="font-size: 0.8rem; color: #7f8c8d; margin-left: auto;">
                                P√°gina ${elemento.page || 1}
                            </span>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border: 1px dashed #9b59b6;">
                            <div style="color: #7f8c8d; margin-bottom: 10px;">
                                <i class="fas fa-chart-pie" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <div style="font-weight: 600;">Gr√°fico del Reporte</div>
                            </div>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">
                                Este gr√°fico fue creado en el editor de informes
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><strong>Posici√≥n:</strong> X:${elemento.position.x}px, Y:${elemento.position.y}px</div>
                            <div><strong>Tama√±o:</strong> ${elemento.size.width}√ó${elemento.size.height}px</div>
                        </div>
                    </div>
                `;
            } else {
                // Elemento desconocido
                modalContent += `
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #95a5a6;">
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-cube"></i>
                            ${elemento.type.charAt(0).toUpperCase() + elemento.type.slice(1)} ${index + 1}
                            <span style="font-size: 0.8rem; color: #7f8c8d; margin-left: auto;">
                                P√°gina ${elemento.page || 1}
                            </span>
                        </div>
                        <div style="font-size: 0.8rem; color: #7f8c8d; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><strong>Posici√≥n:</strong> X:${elemento.position.x}px, Y:${elemento.position.y}px</div>
                            <div><strong>Tama√±o:</strong> ${elemento.size.width}√ó${elemento.size.height}px</div>
                        </div>
                    </div>
                `;
            }
        });

        modalContent += `
                </div>
            </div>
        `;
    }

    modalContent += `</div>`;

    Swal.fire({
        title: 'Visualizando Reporte',
        html: modalContent,
        width: 900,
        padding: '0',
        showCloseButton: true,
        showConfirmButton: false,
        customClass: {
            popup: 'report-modal'
        }
    });
}
// Funci√≥n para cerrar el editor con confirmaci√≥n
function closeEditor() {
    // Verificar si hay contenido en las p√°ginas
    const hasContent = checkEditorContent();
    
    if (hasContent) {
        // Si hay contenido, preguntar si quiere guardar antes de cerrar
        Swal.fire({
            title: '¬øSalir del editor?',
            html: `
                <div style="text-align: left;">
                    <p>Tienes contenido sin guardar en el editor.</p>
                    <div style="background: #fff3cd; color: #856404; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107; margin: 10px 0;">
                        <p style="margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Advertencia:</strong> Si sales sin guardar, perder√°s todo el trabajo no guardado.
                        </p>
                    </div>
                    <p>¬øQu√© deseas hacer?</p>
                </div>
            `,
            icon: 'warning',
            showCancelButton: true,
            showDenyButton: true,
            confirmButtonText: '<i class="fas fa-save"></i> Guardar y salir',
            denyButtonText: '<i class="fas fa-times"></i> Salir sin guardar',
            cancelButtonText: '<i class="fas fa-arrow-left"></i> Seguir editando',
            confirmButtonColor: '#27ae60',
            denyButtonColor: '#e74c3c',
            cancelButtonColor: '#3498db',
            reverseButtons: true,
            width: 500
        }).then(async (result) => {
            if (result.isConfirmed) {
                // Guardar y luego cerrar
                try {
                    await saveReport();
                    closeEditorWithoutPrompt();
                } catch (error) {
                    console.error('Error al guardar:', error);
                    // Si hay error al guardar, preguntar si quiere salir igual
                    Swal.fire({
                        title: 'Error al guardar',
                        text: 'No se pudo guardar el reporte. ¬øQuieres salir sin guardar?',
                        icon: 'error',
                        showCancelButton: true,
                        confirmButtonText: 'S√≠, salir sin guardar',
                        cancelButtonText: 'Quedarme',
                        confirmButtonColor: '#e74c3c'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            closeEditorWithoutPrompt();
                        }
                    });
                }
            } else if (result.isDenied) {
                // Salir sin guardar
                Swal.fire({
                    title: '¬øEst√°s seguro?',
                    text: 'Perder√°s todo el trabajo no guardado',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'S√≠, salir sin guardar',
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#e74c3c',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        closeEditorWithoutPrompt();
                    }
                });
            }
            // Si hace clic en cancelar, no hace nada (se queda en el editor)
        });
    } else {
        // Si no hay contenido, cerrar directamente
        closeEditorWithoutPrompt();
    }
}

// Funci√≥n para verificar si hay contenido en el editor
function checkEditorContent() {
    const pages = document.querySelectorAll('.page');
    let hasContent = false;
    
    pages.forEach(page => {
        const pageContent = page.querySelector('.page-content');
        const pageTitle = page.querySelector('.page-header h3');
        
        // Verificar si hay texto en el contenido (excluyendo HTML tags)
        const textContent = pageContent?.textContent?.trim() || '';
        const originalTitle = pageTitle?.textContent?.trim() || '';
        
        // Lista de t√≠tulos por defecto que no cuentan como contenido
        const defaultTitles = ['PORTADA', 'CONTRAPORTADA', '√çNDICE', 'RESUMEN EJECUTIVO', 'DESARROLLO', 'NUEVA P√ÅGINA'];
        
        // Verificar si hay contenido real (no solo espacios o texto por defecto)
        if (textContent.length > 0 && 
            !textContent.includes('Escribe el t√≠tulo del informe aqu√≠...') &&
            !textContent.includes('Informe generado por Heliconias Reports') &&
            !textContent.includes('Introducci√≥n') && // Del √≠ndice por defecto
            !textContent.includes('Desarrollo') &&   // Del √≠ndice por defecto
            !textContent.includes('Conclusiones')) { // Del √≠ndice por defecto
            
            hasContent = true;
        }
        
        // Verificar si el t√≠tulo fue modificado
        if (originalTitle && !defaultTitles.includes(originalTitle.toUpperCase())) {
            hasContent = true;
        }
        
        // Verificar si hay elementos arrastrables
        const draggableElements = page.querySelectorAll('.draggable-element');
        if (draggableElements.length > 0) {
            hasContent = true;
        }
    });
    
    return hasContent;
}

// Funci√≥n para cerrar el editor sin preguntar (usada internamente)
function closeEditorWithoutPrompt() {
    document.getElementById('editor-panel').style.display = 'none';
    document.getElementById('main-panel').style.display = 'flex';
    
    // Limpiar el editor
    const pagesContainer = document.getElementById('pages-container');
    if (pagesContainer) {
        pagesContainer.innerHTML = '';
    }
    
    // Mostrar mensaje de confirmaci√≥n
    Swal.fire({
        title: 'Editor cerrado',
        text: 'Has salido del editor de informes',
        icon: 'info',
        confirmButtonColor: '#27ae60',
        timer: 1500,
        showConfirmButton: false
    });
}

// Funci√≥n para alternar el sidebar del historial
function toggleHistorySidebar() {
    const sidebar = document.getElementById('history-sidebar');
    const toggleBtn = document.getElementById('history-toggle');
    
    sidebar.classList.toggle('collapsed');
    
    if (sidebar.classList.contains('collapsed')) {
        toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        toggleBtn.title = 'Mostrar historial';
    } else {
        toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
        toggleBtn.title = 'Ocultar historial';
    }
}

// Inicializar el historial
function initializeHistory() {
    loadReports();
    
    // Event listeners para los tabs del historial
    document.querySelectorAll('.history-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.history-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            currentReportTab = this.dataset.tab;
            renderReports();
        });
    });
}

// Bot√≥n cerrar editor
document.getElementById('close-editor-btn').addEventListener('click', closeEditor);

// Bot√≥n toggle del historial
document.getElementById('history-toggle').addEventListener('click', toggleHistorySidebar);

// Inicializar el historial cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    initializeHistory();
});

// Bot√≥n consultar informe (ya existente)
document.querySelector('.btn-primary-large:nth-child(2)').addEventListener('click', function() {
    Swal.fire({
        title: 'Consultar Informes',
        html: `
            <div style="text-align: center;">
                <div style="font-size: 4rem; color: #3498db; margin-bottom: 20px;">
                    <i class="fas fa-search"></i>
                </div>
                <p style="margin-bottom: 20px; font-size: 1.1rem;">
                    Esta funci√≥n te permite buscar y visualizar reportes existentes.<br>
                    Usa el panel de historial a la izquierda para ver todos tus reportes.
                </p>
                <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <p style="margin: 0; color: #3498db; font-weight: 600;">
                        <i class="fas fa-lightbulb"></i>
                        Tip: Haz clic en cualquier reporte del historial para verlo completo
                    </p>
                </div>
            </div>
        `,
        confirmButtonText: 'Entendido',
        confirmButtonColor: '#3498db',
        width: 500
    });
});

// Funci√≥n auxiliar mejorada para obtener el contenido del elemento
function getElementContent(element, type) {
    switch (type) {
        case 'table':
            const table = element.querySelector('table');
            if (table) {
                // Limpiar estilos inline para que se vea bien en el modal
                const cleanTable = table.cloneNode(true);
                cleanTable.querySelectorAll('*').forEach(el => {
                    el.removeAttribute('style');
                });
                return cleanTable.outerHTML;
            }
            return '';
        case 'image':
            const img = element.querySelector('img');
            return img ? img.src : '';
        case 'chart':
            // Para gr√°ficos, guardamos la representaci√≥n HTML
            return element.innerHTML;
        default:
            return element.innerHTML;
    }
}

        // Funci√≥n para actualizar fecha y hora
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString("es-ES", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                hour12: true,
            });

            document.getElementById("current-date-time").textContent = dateTimeString;
        }

        // Inicializar fecha y hora
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Mostrar editor al hacer clic en "Escribir Informe"
        document.getElementById('write-report-btn').addEventListener('click', function() {
            document.getElementById('main-panel').style.display = 'none';
            document.getElementById('editor-panel').style.display = 'block';
            initializeEditor();
        });

        // Inicializar editor
        function initializeEditor() {
            const pagesContainer = document.getElementById('pages-container');
            pagesContainer.innerHTML = '';
            pages.length = 0;

            // Crear p√°ginas iniciales
            const pageTypes = [
                { type: 'portada', title: 'PORTADA' },
                { type: 'contraportada', title: 'CONTRAPORTADA' },
                { type: 'indice', title: '√çNDICE' },
                { type: 'resumen', title: 'RESUMEN EJECUTIVO' },
                { type: 'desarrollo', title: 'DESARROLLO' }
            ];

            pageTypes.forEach((pageType, index) => {
                addPage(pageType.type, pageType.title, index);
            });
        }

        // A√±adir nueva p√°gina
        function addPage(type = 'normal', title = 'NUEVA P√ÅGINA', index = null) {
            const pagesContainer = document.getElementById('pages-container');
            const pageNumber = index !== null ? index : pages.length + 1;
            
            const page = document.createElement('div');
            page.className = `page ${type} ${currentOrientation}`;
            page.innerHTML = `
                <div class="page-header">
                    <h3 contenteditable="true">${title}</h3>
                </div>
                <div class="page-content" contenteditable="true" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)">
                    ${type === 'portada' ? '<p style="text-align: center; font-size: 18px; margin-top: 80px;">Escribe el t√≠tulo del informe aqu√≠...</p>' : ''}
                    ${type === 'contraportada' ? '<p style="text-align: center; margin-top: 120px;">Informe generado por Heliconias Reports</p>' : ''}
                    ${type === 'indice' ? '<ul><li>Introducci√≥n</li><li>Desarrollo</li><li>Conclusiones</li></ul>' : ''}
                </div>
                <div class="page-number">P√°gina ${pageNumber}</div>
            `;

            if (index !== null) {
                pagesContainer.insertBefore(page, pagesContainer.children[index]);
                pages.splice(index, 0, page);
            } else {
                pagesContainer.appendChild(page);
                pages.push(page);
            }

            // Actualizar n√∫meros de p√°gina
            updatePageNumbers();
        }

        // Cambiar orientaci√≥n de p√°gina
        function changeOrientation(orientation) {
            currentOrientation = orientation;
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('vertical', 'horizontal');
                page.classList.add(orientation);
            });
            
            // Actualizar botones activos
            document.querySelectorAll('.orientation-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Actualizar n√∫meros de p√°gina
        function updatePageNumbers() {
            const pageNumbers = document.querySelectorAll('.page-number');
            pageNumbers.forEach((number, index) => {
                number.textContent = `P√°gina ${index + 1}`;
            });
        }

        // Cambiar zoom
        function changeZoom(delta) {
            currentZoom = Math.max(0.5, Math.min(2, currentZoom + delta));
            document.getElementById('pages-container').style.transform = `scale(${currentZoom})`;
            document.getElementById('zoom-level').textContent = `${Math.round(currentZoom * 100)}%`;
        }

        // Funciones de formato de texto (m√°s r√°pidas)
        function formatText(command) {
            document.execCommand(command, false, null);
            document.querySelector('.page-content[contenteditable="true"]').focus();
        }

        function changeFontFamily(font) {
            document.execCommand('fontName', false, font);
            document.querySelector('.page-content[contenteditable="true"]').focus();
        }

        function changeFontSize(size) {
            document.execCommand('fontSize', false, size);
            document.querySelector('.page-content[contenteditable="true"]').focus();
        }

        // Modal para insertar tabla
        function showTableModal() {
            Swal.fire({
                title: 'Crear Tabla',
                html: `
                    <div style="text-align: left;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Filas:</label>
                        <input type="number" id="table-rows" value="3" min="1" max="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Columnas:</label>
                        <input type="number" id="table-cols" value="3" min="1" max="8" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Crear Tabla',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#27ae60',
                preConfirm: () => {
                    const rows = parseInt(document.getElementById('table-rows').value);
                    const cols = parseInt(document.getElementById('table-cols').value);
                    if (rows > 0 && cols > 0) {
                        insertTable(rows, cols);
                    }
                }
            });
        }

        // Insertar tabla
        function insertTable(rows = 3, cols = 3) {
            const tableId = 'table-' + Date.now();
            
            let tableHTML = `
                <div class="draggable-element table-container" id="${tableId}" style="position: absolute; top: 50px; left: 50px; min-width: ${cols * 100}px;">
                    <button class="delete-btn" onclick="deleteElement(this)">√ó</button>
                    <table class="custom-table">
                        <thead>
                            <tr>`;
            
            for (let i = 0; i < cols; i++) {
                tableHTML += `<th contenteditable="true">Columna ${i + 1}</th>`;
            }
            
            tableHTML += `</tr></thead><tbody>`;
            
            for (let i = 0; i < rows; i++) {
                tableHTML += `<tr>`;
                for (let j = 0; j < cols; j++) {
                    tableHTML += `<td contenteditable="true">Dato ${i + 1}-${j + 1}</td>`;
                }
                tableHTML += `</tr>`;
            }
            
            tableHTML += `</tbody></table>
                    <div class="table-controls">
                        <button class="table-control-btn" onclick="addTableRow(this)">+ Fila</button>
                        <button class="table-control-btn" onclick="addTableColumn(this)">+ Columna</button>
                        <button class="table-control-btn" onclick="removeTableRow(this)">- Fila</button>
                        <button class="table-control-btn" onclick="removeTableColumn(this)">- Columna</button>
                        <button class="create-chart-btn" onclick="createChartFromTable(this)">Crear Gr√°fico</button>
                    </div>
                    <div class="resize-handle nw"></div>
                    <div class="resize-handle ne"></div>
                    <div class="resize-handle sw"></div>
                    <div class="resize-handle se"></div>
                </div>`;
            
            document.execCommand('insertHTML', false, tableHTML);
            
            // Hacer la tabla arrastrable y redimensionable
            setTimeout(() => {
                const tableElement = document.getElementById(tableId);
                makeElementDraggable(tableElement);
                makeElementResizable(tableElement);
                adjustPageHeight(tableElement.closest('.page'));
            }, 100);
        }

        // Funciones para manipular tablas
        function addTableRow(button) {
            const table = button.closest('.table-container').querySelector('table');
            const row = table.insertRow();
            const colCount = table.rows[0].cells.length;
            
            for (let i = 0; i < colCount; i++) {
                const cell = row.insertCell();
                cell.contentEditable = true;
                cell.textContent = `Nuevo dato`;
            }
            adjustPageHeight(button.closest('.page'));
        }

        function addTableColumn(button) {
            const table = button.closest('.table-container').querySelector('table');
            const rowCount = table.rows.length;
            
            for (let i = 0; i < rowCount; i++) {
                const cell = table.rows[i].insertCell();
                cell.contentEditable = true;
                cell.textContent = i === 0 ? `Columna ${table.rows[0].cells.length}` : `Nuevo dato`;
            }
            adjustPageHeight(button.closest('.page'));
        }

        function removeTableRow(button) {
            const table = button.closest('.table-container').querySelector('table');
            if (table.rows.length > 2) {
                table.deleteRow(-1);
            }
            adjustPageHeight(button.closest('.page'));
        }

        function removeTableColumn(button) {
            const table = button.closest('.table-container').querySelector('table');
            const colCount = table.rows[0].cells.length;
            if (colCount > 1) {
                for (let i = 0; i < table.rows.length; i++) {
                    table.rows[i].deleteCell(-1);
                }
            }
            adjustPageHeight(button.closest('.page'));
        }

        // Crear gr√°fico desde tabla
        function createChartFromTable(button) {
            const table = button.closest('.table-container').querySelector('table');
            const headers = Array.from(table.rows[0].cells).map(cell => cell.textContent);
            const data = [];
            
            for (let i = 1; i < table.rows.length; i++) {
                const rowData = Array.from(table.rows[i].cells).map(cell => {
                    const value = parseFloat(cell.textContent);
                    return isNaN(value) ? 0 : value;
                });
                data.push(rowData);
            }
            
            // Mostrar modal para seleccionar tipo de gr√°fico
            showChartModalFromData(headers, data);
        }

        // Modal para insertar imagen
        function showImageModal() {
            Swal.fire({
                title: 'Insertar Imagen',
                html: `
                    <div style="text-align: left;">
                        <input type="file" id="image-upload" accept="image/*" style="width: 100%; margin-bottom: 15px;">
                        <p style="font-size: 0.9rem; color: #7f8c8d;">O ingresa una URL:</p>
                        <input type="url" id="image-url" placeholder="https://ejemplo.com/imagen.jpg" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Insertar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#27ae60',
                preConfirm: () => {
                    const fileInput = document.getElementById('image-upload');
                    const urlInput = document.getElementById('image-url');
                    
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            insertImage(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    } else if (urlInput.value) {
                        insertImage(urlInput.value);
                    }
                }
            });
        }

        // Insertar imagen
        function insertImage(src) {
            const imageId = 'image-' + Date.now();
            const imgHTML = `
                <div class="draggable-element image-container" id="${imageId}" style="position: absolute; top: 50px; left: 50px;">
                    <button class="delete-btn" onclick="deleteElement(this)">√ó</button>
                    <img src="${src}" style="max-width: 200px; height: auto; border-radius: 4px;" alt="Imagen insertada">
                    <div class="resize-handle nw"></div>
                    <div class="resize-handle ne"></div>
                    <div class="resize-handle sw"></div>
                    <div class="resize-handle se"></div>
                </div>`;
            
            document.execCommand('insertHTML', false, imgHTML);
            
            // Hacer la imagen arrastrable y redimensionable
            setTimeout(() => {
                const imageElement = document.getElementById(imageId);
                makeElementDraggable(imageElement);
                makeElementResizable(imageElement);
                
                // Ajustar altura de la p√°gina si es necesario
                adjustPageHeight(imageElement.closest('.page'));
            }, 100);
        }

        // Modal para insertar gr√°fico
        function showChartModal() {
            Swal.fire({
                title: 'Insertar Gr√°fico',
                html: `
                    <div style="text-align: left;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Tipo de Gr√°fico:</label>
                        <div class="chart-controls" style="margin-bottom: 15px;">
                            <button type="button" class="chart-type-btn active" data-type="bar">Barras</button>
                            <button type="button" class="chart-type-btn" data-type="pie">Circular</button>
                        </div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Datos (separados por comas):</label>
                        <input type="text" id="chart-data" value="25,50,75,30,60" placeholder="25,50,75,30,60" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <label style="display: block; margin-bottom: 8px; margin-top: 15px; font-weight: 600;">Etiquetas (separadas por comas):</label>
                        <input type="text" id="chart-labels" value="Ene,Feb,Mar,Abr,May" placeholder="Ene,Feb,Mar,Abr,May" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Insertar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#27ae60',
                didOpen: () => {
                    const buttons = document.querySelectorAll('.chart-type-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', function() {
                            buttons.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                        });
                    });
                },
                preConfirm: () => {
                    const activeBtn = document.querySelector('.chart-type-btn.active');
                    const chartType = activeBtn.dataset.type;
                    const data = document.getElementById('chart-data').value;
                    const labels = document.getElementById('chart-labels').value;
                    
                    insertChart(chartType, data.split(','), labels.split(','));
                }
            });
        }

        // Modal para crear gr√°fico desde datos de tabla
        function showChartModalFromData(headers, data) {
            Swal.fire({
                title: 'Crear Gr√°fico desde Tabla',
                html: `
                    <div style="text-align: left;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Tipo de Gr√°fico:</label>
                        <div class="chart-controls" style="margin-bottom: 15px;">
                            <button type="button" class="chart-type-btn active" data-type="bar">Barras</button>
                            <button type="button" class="chart-type-btn" data-type="pie">Circular</button>
                        </div>
                        <p style="font-size: 0.9rem; color: #7f8c8d;">Se crear√°n ${data.length} series de datos</p>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Crear Gr√°fico',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#27ae60',
                didOpen: () => {
                    const buttons = document.querySelectorAll('.chart-type-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', function() {
                            buttons.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                        });
                    });
                },
                preConfirm: () => {
                    const activeBtn = document.querySelector('.chart-type-btn.active');
                    const chartType = activeBtn.dataset.type;
                    
                    insertChartFromTableData(chartType, headers, data);
                }
            });
        }

        // Insertar gr√°fico desde datos de tabla
        function insertChartFromTableData(type, headers, data) {
            const chartId = 'chart-' + Date.now();
            const colors = ['#27ae60', '#3498db', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
            
            let chartHTML = `
                <div class="draggable-element chart-container" id="${chartId}" style="position: absolute; top: 50px; left: 50px; width: 300px;">
                    <button class="delete-btn" onclick="deleteElement(this)">√ó</button>
                    <div class="chart-placeholder" style="position: relative;">
                        <div style="position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; display: flex; align-items: end; justify-content: space-around;">`;
            
            if (type === 'bar') {
                // Gr√°fico de barras m√∫ltiples
                const maxValue = Math.max(...data.flat());
                data.forEach((series, seriesIndex) => {
                    series.forEach((value, index) => {
                        const height = (value / maxValue) * 80;
                        chartHTML += `
                            <div style="display: flex; flex-direction: column; align-items: center; margin: 0 2px;">
                                <div style="width: 15px; height: ${height}%; background: ${colors[seriesIndex % colors.length]}; border-radius: 3px 3px 0 0; margin: 0 1px;"></div>
                            </div>`;
                    });
                });
                
                chartHTML += `</div></div>`;
                
                // Leyenda
                chartHTML += `<div style="margin-top: 10px; font-size: 10px;">`;
                headers.forEach((header, index) => {
                    chartHTML += `
                        <div style="display: inline-block; margin: 0 5px;">
                            <span style="display: inline-block; width: 10px; height: 10px; background: ${colors[index % colors.length]}; margin-right: 3px;"></span>
                            ${header}
                        </div>`;
                });
                chartHTML += `</div>`;
            } else {
                // Gr√°fico circular
                const total = data.flat().reduce((a, b) => a + b, 0);
                chartHTML += `
                    <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(`;
                
                let currentAngle = 0;
                data.flat().forEach((value, index) => {
                    const percentage = (value / total) * 100;
                    const angle = (percentage / 100) * 360;
                    chartHTML += `${colors[index % colors.length]} ${currentAngle}deg ${currentAngle + angle}deg${index < data.flat().length - 1 ? ', ' : ''}`;
                    currentAngle += angle;
                });
                
                chartHTML += `);"></div>
                    <div style="margin-left: 10px;">
                        ${headers.map((header, index) => `
                            <div style="display: flex; align-items: center; margin-bottom: 3px; font-size: 10px;">
                                <div style="width: 10px; height: 10px; background: ${colors[index % colors.length]}; margin-right: 5px; border-radius: 2px;"></div>
                                ${header}
                            </div>
                        `).join('')}
                    </div>`;
                chartHTML += `</div></div>`;
            }
            
            chartHTML += `
                    <div class="resize-handle nw"></div>
                    <div class="resize-handle ne"></div>
                    <div class="resize-handle sw"></div>
                    <div class="resize-handle se"></div>
                </div>`;
            
            document.execCommand('insertHTML', false, chartHTML);
            
            // Hacer el gr√°fico arrastrable y redimensionable
            setTimeout(() => {
                const chartElement = document.getElementById(chartId);
                makeElementDraggable(chartElement);
                makeElementResizable(chartElement);
                adjustPageHeight(chartElement.closest('.page'));
            }, 100);
        }

        // Insertar gr√°fico
        function insertChart(type, data, labels) {
            const chartId = 'chart-' + Date.now();
            const colors = ['#27ae60', '#3498db', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
            
            let chartHTML = `
                <div class="draggable-element chart-container" id="${chartId}" style="position: absolute; top: 50px; left: 50px; width: 300px;">
                    <button class="delete-btn" onclick="deleteElement(this)">√ó</button>
                    <div class="chart-placeholder" style="position: relative;">
                        <div style="position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; display: flex; align-items: end; justify-content: space-around;">`;
            
            if (type === 'bar') {
                // Gr√°fico de barras
                const maxValue = Math.max(...data);
                data.forEach((value, index) => {
                    const height = (value / maxValue) * 100;
                    chartHTML += `
                        <div style="display: flex; flex-direction: column; align-items: center; margin: 0 5px;">
                            <div style="width: 25px; height: ${height}%; background: ${colors[index % colors.length]}; border-radius: 3px 3px 0 0;"></div>
                            <div style="margin-top: 5px; font-size: 10px; text-align: center;">${labels[index] || `Dato ${index + 1}`}</div>
                            <div style="font-size: 9px; margin-top: 2px;">${value}</div>
                        </div>`;
                });
            } else {
                // Gr√°fico circular
                const total = data.reduce((a, b) => parseInt(a) + parseInt(b), 0);
                chartHTML += `
                    <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(`;
                
                let currentAngle = 0;
                data.forEach((value, index) => {
                    const percentage = (value / total) * 100;
                    const angle = (percentage / 100) * 360;
                    chartHTML += `${colors[index % colors.length]} ${currentAngle}deg ${currentAngle + angle}deg${index < data.length - 1 ? ', ' : ''}`;
                    currentAngle += angle;
                });
                
                chartHTML += `);"></div>
                    <div style="margin-left: 10px;">
                        ${data.map((value, index) => `
                            <div style="display: flex; align-items: center; margin-bottom: 3px; font-size: 10px;">
                                <div style="width: 10px; height: 10px; background: ${colors[index % colors.length]}; margin-right: 5px; border-radius: 2px;"></div>
                                ${labels[index] || `Dato ${index + 1}`}: ${value}
                            </div>
                        `).join('')}
                    </div>`;
            }
            
            chartHTML += `
                        </div>
                    </div>
                    <div class="resize-handle nw"></div>
                    <div class="resize-handle ne"></div>
                    <div class="resize-handle sw"></div>
                    <div class="resize-handle se"></div>
                </div>`;
            
            document.execCommand('insertHTML', false, chartHTML);
            
            // Hacer el gr√°fico arrastrable y redimensionable
            setTimeout(() => {
                const chartElement = document.getElementById(chartId);
                makeElementDraggable(chartElement);
                makeElementResizable(chartElement);
                adjustPageHeight(chartElement.closest('.page'));
            }, 100);
        }

        // Eliminar elemento
        function deleteElement(button) {
            const element = button.closest('.draggable-element');
            if (element) {
                element.remove();
                adjustPageHeight(element.closest('.page'));
            }
        }

        // Hacer elemento arrastrable
        function makeElementDraggable(element) {
            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDrag);
            
            function startDrag(e) {
                if (e.target.classList.contains('delete-btn') || e.target.classList.contains('resize-handle')) {
                    return;
                }
                
                e.preventDefault();
                selectedElement = element;
                isDragging = true;
                
                const rect = element.getBoundingClientRect();
                const pageRect = element.closest('.page-content').getBoundingClientRect();
                
                if (e.type === 'mousedown') {
                    dragOffset.x = e.clientX - rect.left;
                    dragOffset.y = e.clientY - rect.top;
                } else {
                    dragOffset.x = e.touches[0].clientX - rect.left;
                    dragOffset.y = e.touches[0].clientY - rect.top;
                }
                
                // Seleccionar elemento
                document.querySelectorAll('.draggable-element').forEach(el => {
                    el.classList.remove('selected');
                });
                element.classList.add('selected');
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                let clientX, clientY;
                if (e.type === 'mousemove') {
                    clientX = e.clientX;
                    clientY = e.clientY;
                } else {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                }
                
                const pageRect = element.closest('.page-content').getBoundingClientRect();
                const newX = clientX - pageRect.left - dragOffset.x;
                const newY = clientY - pageRect.top - dragOffset.y;
                
                // Limitar movimiento dentro de la p√°gina
                const maxX = pageRect.width - element.offsetWidth;
                const maxY = pageRect.height - element.offsetHeight;
                
                element.style.left = Math.max(0, Math.min(maxX, newX)) + 'px';
                element.style.top = Math.max(0, Math.min(maxY, newY)) + 'px';
                
                // Ajustar altura de la p√°gina si es necesario
                adjustPageHeight(element.closest('.page'));
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchend', stopDrag);
            }
        }

        // Hacer elemento redimensionable
        function makeElementResizable(element) {
            const handles = element.querySelectorAll('.resize-handle');
            
            handles.forEach(handle => {
                handle.addEventListener('mousedown', startResize);
                handle.addEventListener('touchstart', startResize);
            });
            
            function startResize(e) {
                e.preventDefault();
                e.stopPropagation();
                
                isResizing = true;
                currentResizeHandle = e.target.classList[1]; // nw, ne, sw, se
                
                const startWidth = element.offsetWidth;
                const startHeight = element.offsetHeight;
                const startX = element.offsetLeft;
                const startY = element.offsetTop;
                const startMouseX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
                const startMouseY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
                
                document.addEventListener('mousemove', resize);
                document.addEventListener('touchmove', resize);
                document.addEventListener('mouseup', stopResize);
                document.addEventListener('touchend', stopResize);
                
                function resize(e) {
                    if (!isResizing) return;
                    
                    let mouseX, mouseY;
                    if (e.type === 'mousemove') {
                        mouseX = e.clientX;
                        mouseY = e.clientY;
                    } else {
                        mouseX = e.touches[0].clientX;
                        mouseY = e.touches[0].clientY;
                    }
                    
                    const deltaX = mouseX - startMouseX;
                    const deltaY = mouseY - startMouseY;
                    
                    let newWidth = startWidth;
                    let newHeight = startHeight;
                    let newX = startX;
                    let newY = startY;
                    
                    switch (currentResizeHandle) {
                        case 'se':
                            newWidth = Math.max(50, startWidth + deltaX);
                            newHeight = Math.max(50, startHeight + deltaY);
                            break;
                        case 'sw':
                            newWidth = Math.max(50, startWidth - deltaX);
                            newHeight = Math.max(50, startHeight + deltaY);
                            newX = startX + deltaX;
                            break;
                        case 'ne':
                            newWidth = Math.max(50, startWidth + deltaX);
                            newHeight = Math.max(50, startHeight - deltaY);
                            newY = startY + deltaY;
                            break;
                        case 'nw':
                            newWidth = Math.max(50, startWidth - deltaX);
                            newHeight = Math.max(50, startHeight - deltaY);
                            newX = startX + deltaX;
                            newY = startY + deltaY;
                            break;
                    }
                    
                    // Aplicar nuevos tama√±os y posiciones
                    element.style.width = newWidth + 'px';
                    element.style.height = newHeight + 'px';
                    element.style.left = newX + 'px';
                    element.style.top = newY + 'px';
                    
                    // Ajustar altura de la p√°gina si es necesario
                    adjustPageHeight(element.closest('.page'));
                }
                
                function stopResize() {
                    isResizing = false;
                    document.removeEventListener('mousemove', resize);
                    document.removeEventListener('touchmove', resize);
                    document.removeEventListener('mouseup', stopResize);
                    document.removeEventListener('touchend', stopResize);
                }
            }
        }

        // Ajustar altura de la p√°gina seg√∫n el contenido
        function adjustPageHeight(page) {
            if (!page) return;
            
            const content = page.querySelector('.page-content');
            const elements = content.querySelectorAll('.draggable-element');
            let maxBottom = 0;
            
            elements.forEach(element => {
                const bottom = element.offsetTop + element.offsetHeight;
                if (bottom > maxBottom) {
                    maxBottom = bottom;
                }
            });
            
            // A√±adir margen inferior
            const requiredHeight = maxBottom + 100;
            
            // Siempre ajustar la altura sin l√≠mites
            page.style.minHeight = requiredHeight + 'px';
        }

        // Handlers para drag and drop
        function dragOverHandler(e) {
            e.preventDefault();
        }

        function dropHandler(e) {
            e.preventDefault();
        }

  // Funci√≥n para guardar el reporte completo en la base de datos
// Funci√≥n para guardar el reporte completo en la base de datos
async function saveReport() {
    try {
        // Verificar autenticaci√≥n antes de guardar
        const user = await checkAuth();
        if (!user) {
            throw new Error('Usuario no autenticado');
        }

        Swal.fire({
            title: 'Guardando...',
            text: 'Procesando el informe',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        // 1. Recopilar el contenido de todas las p√°ginas
        const pagesData = [];
        const pages = document.querySelectorAll('.page');
        
        pages.forEach((page, index) => {
            // Limpiar el contenido de elementos draggable para evitar duplicados
            let cleanContent = page.querySelector('.page-content')?.innerHTML || '';
            
            // Remover elementos draggable del contenido principal
            cleanContent = cleanContent.replace(/<div[^>]*class="[^"]*draggable-element[^"]*"[^>]*>[\s\S]*?<\/div>/g, '');
            
            const pageContent = {
                pageNumber: index + 1,
                title: page.querySelector('.page-header h3')?.textContent || `P√°gina ${index + 1}`,
                content: cleanContent,
                type: Array.from(page.classList).find(cls => 
                    ['portada', 'contraportada', 'indice', 'resumen', 'desarrollo', 'normal'].includes(cls)
                ) || 'normal',
                orientation: currentOrientation
            };
            pagesData.push(pageContent);
        });

        // 2. Recopilar elementos arrastrables (tablas, im√°genes, gr√°ficos)
        const elementsData = [];
        const draggableElements = document.querySelectorAll('.draggable-element');
        
        draggableElements.forEach((element, index) => {
            const elementType = element.classList.contains('table-container') ? 'table' :
                              element.classList.contains('image-container') ? 'image' :
                              element.classList.contains('chart-container') ? 'chart' : 'unknown';
            
            const elementData = {
                id: `element-${Date.now()}-${index}`,
                type: elementType,
                position: {
                    x: parseInt(element.style.left) || 0,
                    y: parseInt(element.style.top) || 0
                },
                size: {
                    width: parseInt(element.style.width) || element.offsetWidth,
                    height: parseInt(element.style.height) || element.offsetHeight
                },
                content: getElementContent(element, elementType),
                page: getElementPageNumber(element),
                style: element.style.cssText
            };
            
            elementsData.push(elementData);
        });

        // 3. Preparar datos para guardar - CON usuario autenticado
        const reportData = {
            titulo: pagesData[0]?.title || 'Informe sin t√≠tulo',
            contenido: JSON.stringify(pagesData),
            elementos: elementsData,
            estado: 'borrador',
            id_usuario: user.id // Usar el ID del usuario autenticado
        };

        console.log('Datos a guardar con usuario:', reportData);

        // 4. Guardar en Supabase
        const { data, error } = await supabase
            .from('reportes')
            .insert([reportData])
            .select();

        if (error) {
            console.error('Error de Supabase:', error);
            throw error;
        }

        // 5. Procesar im√°genes si existen
        const imageElements = elementsData.filter(el => el.type === 'image');
        for (const imageElement of imageElements) {
            if (imageElement.content.startsWith('data:')) {
                try {
                    const imageUrl = await uploadImageToServer(imageElement.content);
                    // Actualizar el elemento con la nueva URL
                    imageElement.content = imageUrl;
                } catch (uploadError) {
                    console.warn('Error subiendo imagen:', uploadError);
                    // Continuar aunque falle una imagen
                }
            }
        }

        // 6. Actualizar el reporte con las URLs de las im√°genes si hubo cambios
        if (imageElements.some(el => el.content.startsWith('http'))) {
            const { error: updateError } = await supabase
                .from('reportes')
                .update({ 
                    elementos: elementsData
                })
                .eq('id_reporte', data[0].id_reporte);

            if (updateError) {
                console.warn('Error actualizando im√°genes:', updateError);
            }
        }

        Swal.close();
        
        // 7. Mostrar confirmaci√≥n de √©xito
        Swal.fire({
            title: '¬°Guardado Exitoso!',
            html: `
                <div style="text-align: center;">
                    <div style="font-size: 4rem; color: #27ae60; margin-bottom: 20px;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <p style="margin-bottom: 15px; font-size: 1.3rem; font-weight: 700; color: #27ae60;">
                        Informe Guardado
                    </p>
                    <div style="background: #f8fff8; padding: 15px; border-radius: 10px; border: 2px solid #e8f5e8; margin: 15px 0;">
                        <p style="margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: #2c3e50;">
                            <i class="fas fa-file-alt"></i> ${reportData.titulo}
                        </p>
                        <p style="margin: 0; font-size: 0.95rem; color: #27ae60;">
                            <i class="fas fa-layer-group"></i> ${pages.length} p√°ginas
                        </p>
                        <p style="margin: 0; font-size: 0.9rem; color: #7f8c8d;">
                            <i class="fas fa-user"></i> ${user.email}
                        </p>
                        <p style="margin: 8px 0 0 0; font-size: 0.9rem; color: #7f8c8d;">
                            ID: ${data[0].id_reporte}
                        </p>
                    </div>
                    <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 10px;">
                        El informe ha sido guardado en la base de datos
                    </p>
                </div>
            `,
            icon: 'success',
            confirmButtonColor: '#27ae60',
            confirmButtonText: '<i class="fas fa-thumbs-up"></i> ¬°Perfecto!',
            width: 500
        });

        // Recargar la lista de reportes
        loadReports();

        return data[0];

    } catch (error) {
        console.error('Error guardando reporte:', error);
        Swal.close();
        
        let errorMessage = 'No se pudo guardar el informe';
        
        if (error.message.includes('Usuario no autenticado')) {
            errorMessage = 'Debes iniciar sesi√≥n para guardar informes.';
        } else if (error.message.includes('foreign key constraint')) {
            errorMessage = 'Error: El usuario no existe en la base de datos.';
        } else {
            errorMessage = 'No se pudo guardar el informe: ' + error.message;
        }
        
        Swal.fire({
            title: 'Error al Guardar',
            text: errorMessage,
            icon: 'error',
            confirmButtonColor: '#e74c3c',
            confirmButtonText: 'Entendido'
        });
        
        throw error;
    }
}

// Funci√≥n auxiliar para obtener el contenido del elemento
function getElementContent(element, type) {
    switch (type) {
        case 'table':
            return element.querySelector('table')?.outerHTML || '';
        case 'image':
            const img = element.querySelector('img');
            return img ? img.src : '';
        case 'chart':
            return element.innerHTML;
        default:
            return element.innerHTML;
    }
}


// Funci√≥n para verificar autenticaci√≥n
async function checkAuth() {
    try {
        const { data: { user }, error } = await supabase.auth.getUser();
        
        if (error) {
            console.error('Error verificando autenticaci√≥n:', error);
            showLoginModal();
            return null;
        }
        
        if (!user) {
            showLoginModal();
            return null;
        }
        
        currentUser = user;
        updateUIWithUser(user);
        return user;
        
    } catch (error) {
        console.error('Error en checkAuth:', error);
        showLoginModal();
        return null;
    }
}

// Funci√≥n para mostrar modal de login
function showLoginModal() {
    Swal.fire({
        title: 'Autenticaci√≥n Requerida',
        html: `
            <div style="text-align: center;">
                <div style="font-size: 4rem; color: #e74c3c; margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p style="margin-bottom: 20px; font-size: 1.1rem;">
                    Debes iniciar sesi√≥n para guardar informes.
                </p>
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <p style="margin: 0; color: #856404; font-weight: 600;">
                        <i class="fas fa-info-circle"></i>
                        Tu trabajo se perder√° si no inicias sesi√≥n.
                    </p>
                </div>
            </div>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '<i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n',
        cancelButtonText: 'Continuar sin guardar',
        confirmButtonColor: '#27ae60',
        cancelButtonColor: '#e74c3c',
        width: 500
    }).then((result) => {
        if (result.isConfirmed) {
            redirectToLogin();
        }
    });
}

// Funci√≥n para redirigir al login
function redirectToLogin() {
    window.location.href = 'login.html'; // Crea esta p√°gina despu√©s
}

// Actualizar UI con informaci√≥n del usuario
function updateUIWithUser(user) {
    const userInfoElement = document.getElementById('user-info');
    if (userInfoElement) {
        userInfoElement.innerHTML = `
            <span style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-user-circle"></i>
                ${user.email}
            </span>
        `;
    }
}
// Funci√≥n auxiliar para obtener el n√∫mero de p√°gina del elemento
function getElementPageNumber(element) {
    const page = element.closest('.page');
    const pageNumberElement = page?.querySelector('.page-number');
    if (pageNumberElement) {
        const match = pageNumberElement.textContent.match(/P√°gina (\d+)/);
        return match ? parseInt(match[1]) : 1;
    }
    return 1;
}
  
// Funci√≥n para subir im√°genes al servidor (Supabase Storage)
async function uploadImageToServer(imageData) {
    try {
        // Convertir base64 a blob
        const response = await fetch(imageData);
        const blob = await response.blob();
        
        // Crear nombre √∫nico para la imagen
        const fileName = `reportes/image_${Date.now()}_${Math.random().toString(36).substr(2, 9)}.png`;
        
        // Subir a Supabase Storage
        const { data, error } = await supabase.storage
            .from('reportes') // Bucket para reportes
            .upload(fileName, blob, {
                cacheControl: '3600',
                upsert: false
            });

        if (error) throw error;

        // Obtener URL p√∫blica
        const { data: { publicUrl } } = supabase.storage
            .from('reportes')
            .getPublicUrl(fileName);

        console.log('Imagen subida:', publicUrl);
        return publicUrl;

    } catch (error) {
        console.error('Error subiendo imagen:', error);
        // Si falla la subida, mantener el base64 como fallback
        return imageData;
    }
}
      // Bot√≥n Guardar - Versi√≥n corregida
document.getElementById('save-report-btn').addEventListener('click', async function() {
    // Primero preguntar si quiere guardar
    const result = await Swal.fire({
        title: '¬øGuardar informe?',
        html: `
            <div style="text-align: left;">
                <p>¬øDeseas guardar el informe actual en la base de datos?</p>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <p style="margin: 0; font-size: 0.9rem; color: #7f8c8d;">
                        <i class="fas fa-info-circle"></i> Se guardar√°n:
                    </p>
                    <ul style="margin: 5px 0 0 15px; font-size: 0.85rem; color: #7f8c8d;">
                        <li>Contenido de todas las p√°ginas</li>
                        <li>Tablas, im√°genes y gr√°ficos</li>
                        <li>Posiciones y tama√±os de elementos</li>
                    </ul>
                </div>
            </div>
        `,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#27ae60',
        cancelButtonColor: '#e74c3c',
        confirmButtonText: '<i class="fas fa-save"></i> S√≠, guardar',
        cancelButtonText: '<i class="fas fa-times"></i> Cancelar',
        reverseButtons: true,
        width: 500
    });

    if (result.isConfirmed) {
        try {
            // Ejecutar el guardado completo
            await saveReport();
        } catch (error) {
            console.error('Error en el proceso de guardado:', error);
        }
    }
});

        // Bot√≥n de ayuda del header
        document.getElementById('help-main-btn').addEventListener('click', function() {
            Swal.fire({
                title: '<div style="display: flex; align-items: center; gap: 10px; color: #2c3e50;"><i class="fas fa-home" style="color: #27ae60; font-size: 1.5rem;"></i><span>Centro de Ayuda - Panel Principal</span></div>',
                html: `
                    <div style="text-align: left;">
                        <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="margin: 0; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-star"></i>
                                Funcionalidades Principales
                            </h4>
                        </div>
                        
                        <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #27ae60;">
                                <i class="fas fa-file-signature" style="color: #27ae60; font-size: 1.2rem; margin-top: 2px;"></i>
                                <div>
                                    <strong style="color: #2c3e50;">Escribir Informes</strong>
                                    <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Crea y registra nuevos reportes de actividades, eventos e incidentes del parque</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                                <i class="fas fa-search-plus" style="color: #3498db; font-size: 1.2rem; margin-top: 2px;"></i>
                                <div>
                                    <strong style="color: #2c3e50;">Consultar Informes</strong>
                                    <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Busca y visualiza reportes existentes en el sistema de manera r√°pida</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #ffeaa7, #fab1a0); padding: 15px; border-radius: 10px; border-left: 4px solid #e17055; margin-bottom: 20px;">
                            <h5 style="margin: 0 0 8px 0; color: #2d3436; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-graduation-cap"></i>
                                Consejos de Navegaci√≥n
                            </h5>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                                    <i class="fas fa-mouse-pointer" style="color: #27ae60;"></i>
                                    Acceso R√°pido
                                </span>
                                <span style="background: white; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; color: #2d3436; display: flex; align-items: center; gap: 5px;">
                                    <i class="fas fa-bolt" style="color: #f39c12;"></i>
                                    Botones Principales
                                </span>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <p style="margin: 0; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-rocket"></i>
                                ¬°Comienza seleccionando cualquier funci√≥n del men√∫ superior!
                            </p>
                        </div>
                    </div>
                `,
                icon: 'info',
                showCloseButton: true,
                confirmButtonColor: '#27ae60',
                confirmButtonText: '<i class="fas fa-check-circle"></i> ¬°Empezar!',
                width: 650,
                background: '#ffffff',
                customClass: {
                    popup: 'animated-popup',
                    title: 'custom-title',
                    htmlContainer: 'custom-html',
                    confirmButton: 'custom-confirm-btn'
                },
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            });
        });

        // Bot√≥n de ayuda principal
        document.getElementById('help-main-btn').addEventListener('click', function() {
            Swal.fire({
                title: '¬øQu√© hace esta p√°gina?',
                html: `
                    <div style="text-align: left;">
                        <p><strong>Heliconias Reports</strong> es el sistema de gesti√≥n del Parque de las Heliconias que te permite:</p>
                        <ul style="list-style: none; padding-left: 0;">
                            <li style="margin-bottom: 12px;">üìã <strong>Escribir Informes:</strong> Crear y registrar nuevos reportes de actividades, eventos e incidentes</li>
                            <li style="margin-bottom: 12px;">üîé <strong>Consultar Informes:</strong> Buscar y visualizar reportes existentes en el sistema</li>
                            <li style="margin-bottom: 12px;">üìÖ <strong>Gestionar Eventos:</strong> Administrar el calendario de eventos del parque</li>
                            <li style="margin-bottom: 12px;">üìà <strong>Generar Reportes:</strong> Crear reportes estad√≠sticos y financieros</li>
                            <li style="margin-bottom: 12px;">üí∞ <strong>Control Financiero:</strong> Gestionar ingresos, gastos y presupuestos</li>
                            <li style="margin-bottom: 12px;">üïí <strong>Historial:</strong> Consultar el registro hist√≥rico de todas las actividades</li>
                            <li style="margin-bottom: 12px;">‚öôÔ∏è <strong>Configuraci√≥n:</strong> Personalizar ajustes del sistema</li>
                        </ul>
                        <p style="text-align: center; margin-top: 20px; font-weight: bold; color: #17a2b8;">¬°Selecciona la opci√≥n que necesites para comenzar!</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Entendido',
                confirmButtonColor: '#17a2b8',
                width: '650px',
                background: '#f8f9fa',
                customClass: {
                    title: 'custom-title',
                    htmlContainer: 'custom-html'
                }
            });
        });

        // Bot√≥n de salir
        document.getElementById("logout-btn").addEventListener("click", function() {
            Swal.fire({
                title: '¬øEst√°s seguro?',
                text: "¬øQuieres cerrar sesi√≥n?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#27ae60',
                cancelButtonColor: '#e74c3c',
                confirmButtonText: 'S√≠, salir',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Saliendo...',
                        text: "Cerrando sesi√≥n",
                        icon: 'info',
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                        didOpen: () => {
                            Swal.showLoading()
                        }
                    }).then(() => {
                        window.location.href = 'index.html';
                    });
                }
            });
        });
    </script>
</body>
</html>